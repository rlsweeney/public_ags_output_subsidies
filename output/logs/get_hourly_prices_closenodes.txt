-----------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\GitDir\Projects\ags_capital_vs_output/output/logs/get_hourly_prices_closenodes.txt
  log type:  text
 opened on:  20 Feb 2022, 19:41:41

. ********************************************************************************
. 
. //
. // use "$repodir/generated_data/facility_closestaggnode.dta", clear
. // gen nwind = 1
. // gen n1603 = flag_1603
. // collapse (min) km (sum) nwind (sum) n1603 (sum) iso_match, by(my_node_id)
. // rename km_to_my_node_id km_to_wind
. // gen flag_nearwind = 1
. // save closestnodelist, replace
. 
. // use "$repodir/generated_data/facility_closestaggnode.dta", clear
. // bys my_node_id: gen tn = _n
. // keep if tn == 1
. // drop tn
. // save uniquenodes, replace
. 
. use "$repodir/generated_data/facility_closestnode.dta", clear

. append using "$repodir/generated_data/facility_closestnode_ISO.dta"

. bys my_node_string: gen tn = _n

. keep if tn == 1
(1,139 observations deleted)

. drop tn

. save uniquenodes, replace
(note: file uniquenodes.dta not found)
file uniquenodes.dta saved

. 
. ** MISO 
. use uniquenodes, clear

. keep if my_node_is == "MISO"
(283 observations deleted)

. di _N
155

. save isonodes, replace
(note: file isonodes.dta not found)
file isonodes.dta saved

. 
. use isonodes, clear

. keep node_name

. merge 1:m node_name using "$dropbox/Data/public/ISO_LMP/MISO/miso_2009.dta", nogen keep(match master)

    Result                           # of obs.
    -----------------------------------------
    not matched                            15
        from master                        15  
        from using                          0  

    matched                         1,011,408  
    -----------------------------------------

. save apdat, replace 
(note: file apdat.dta not found)
file apdat.dta saved

. 
. forval i = 2010/2015 {
  2.         use isonodes, clear
  3.         keep node_name
  4.         merge 1:m node_name using "$dropbox/Data/public/ISO_LMP/MISO/miso_`i'.dta", nogen keep(match master)
  5.         append using apdat
  6.         save apdat, replace 
  7. }

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                         1,287,960  
    -----------------------------------------
file apdat.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                         1,357,800  
    -----------------------------------------
file apdat.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                         1,357,800  
    -----------------------------------------
(note: variable lmp was float, now double to accommodate using data's values)
(note: variable mcc was float, now double to accommodate using data's values)
(note: variable mlc was float, now double to accommodate using data's values)
file apdat.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                         1,357,800  
    -----------------------------------------
(note: variable lmp was float, now double to accommodate using data's values)
(note: variable mcc was float, now double to accommodate using data's values)
(note: variable mlc was float, now double to accommodate using data's values)
file apdat.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                         1,357,800  
    -----------------------------------------
(note: variable lmp was float, now double to accommodate using data's values)
(note: variable mcc was float, now double to accommodate using data's values)
(note: variable mlc was float, now double to accommodate using data's values)
file apdat.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                         1,357,800  
    -----------------------------------------
(note: variable lmp was float, now double to accommodate using data's values)
(note: variable mcc was float, now double to accommodate using data's values)
(note: variable mlc was float, now double to accommodate using data's values)
file apdat.dta saved

. 
. save miso_plant_nodes, replace
(note: file miso_plant_nodes.dta not found)
file miso_plant_nodes.dta saved

. 
. 
. ** CAISO 
. use uniquenodes, clear

. keep if my_node_is == "CAISO"
(361 observations deleted)

. di _N
77

. save isonodes, replace
file isonodes.dta saved

. 
. use isonodes, clear

. keep node_name

. merge 1:m node_name using "$dropbox/Data/public/ISO_LMP/CAISO/caiso2009.dta", nogen keep(match master)

    Result                           # of obs.
    -----------------------------------------
    not matched                             8
        from master                         8  
        from using                          0  

    matched                           420,323  
    -----------------------------------------

. save apdat, replace 
file apdat.dta saved

. 
. forval i = 2010/2015 {
  2.         use isonodes, clear
  3.         keep node_name
  4.         merge 1:m node_name using "$dropbox/Data/public/ISO_LMP/CAISO/caiso`i'.dta", nogen keep(match master)
  5.         append using apdat
  6.         save apdat, replace 
  7. }

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           600,800  
    -----------------------------------------
file apdat.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           644,644  
    -----------------------------------------
file apdat.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           646,723  
    -----------------------------------------
file apdat.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           645,645  
    -----------------------------------------
file apdat.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           644,721  
    -----------------------------------------
file apdat.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           644,567  
    -----------------------------------------
file apdat.dta saved

. 
. save caiso_plant_nodes, replace
(note: file caiso_plant_nodes.dta not found)
file caiso_plant_nodes.dta saved

. 
. 
. 
. ** ERCOT 
. use uniquenodes, clear

. keep if my_node_is == "ERCOT"
(377 observations deleted)

. di _N
61

. save isonodes, replace
file isonodes.dta saved

. 
. use isonodes, clear

. keep node_name

. merge 1:m node_name using "$dropbox/Data/public/ISO_LMP/ERCOT/ercot_2010.dta", nogen keep(match master)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                            45,384  
    -----------------------------------------

. save apdat, replace 
file apdat.dta saved

. 
. forval i = 2011/2015 {
  2.         use isonodes, clear
  3.         keep node_name
  4.         merge 1:m node_name using "$dropbox/Data/public/ISO_LMP/ERCOT/ercot_`i'.dta", nogen keep(match master)
  5.         append using apdat
  6.         save apdat, replace 
  7. }

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           534,177  
    -----------------------------------------
(note: variable lmp was float, now double to accommodate using data's values)
file apdat.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           535,763  
    -----------------------------------------
(note: variable lmp was float, now double to accommodate using data's values)
file apdat.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           534,299  
    -----------------------------------------
(note: variable lmp was float, now double to accommodate using data's values)
file apdat.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           533,628  
    -----------------------------------------
(note: variable lmp was float, now double to accommodate using data's values)
file apdat.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           191,723  
    -----------------------------------------
(note: variable lmp was float, now double to accommodate using data's values)
file apdat.dta saved

. 
. save ercot_plant_nodes, replace
(note: file ercot_plant_nodes.dta not found)
file ercot_plant_nodes.dta saved

. 
. 
. ** PJM
. use uniquenodes, clear

. keep if my_node_is == "PJM"
(350 observations deleted)

. di _N
88

. keep node_name node_id

. save isonodes, replace
file isonodes.dta saved

. 
. use "$dropbox/Data/public/ISO_LMP/PJM/pjm_2009.dta", clear

. sort node_name node_id date hour lmp

. bys node_name node_id date hour: gen tn = _n

. keep if tn == 1
(8,736 observations deleted)

. drop tn 

. merge m:1 node_name node_id using isonodes, nogen keep(match)
(note: variable node_name was str19, now str35 to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           631,704  
    -----------------------------------------

. save apdat, replace 
file apdat.dta saved

. 
. 
. forval i = 2010/2015 {
  2.         use "$dropbox/Data/public/ISO_LMP/PJM/pjm_`i'.dta", clear
  3.         sort node_name node_id date hour lmp
  4.         bys node_name node_id date hour: gen tn = _n
  5.         keep if tn == 1
  6.         drop tn 
  7.         merge m:1 node_name node_id using isonodes, nogen keep(match)
  8.         append using apdat
  9.         save apdat, replace 
 10. }
(8,736 observations deleted)
(note: variable node_name was str19, now str35 to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           724,728  
    -----------------------------------------
file apdat.dta saved
(8,736 observations deleted)
(note: variable node_name was str19, now str35 to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           770,880  
    -----------------------------------------
file apdat.dta saved
(8,760 observations deleted)
(note: variable node_name was str19, now str35 to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           772,992  
    -----------------------------------------
file apdat.dta saved
(8,736 observations deleted)
(note: variable node_name was str19, now str35 to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           770,880  
    -----------------------------------------
file apdat.dta saved
(8,736 observations deleted)
(note: variable node_name was str19, now str35 to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           770,880  
    -----------------------------------------
file apdat.dta saved
(8,736 observations deleted)
(note: variable node_name was str22, now str35 to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           770,880  
    -----------------------------------------
file apdat.dta saved

. 
. save pjm_plant_nodes, replace
(note: file pjm_plant_nodes.dta not found)
file pjm_plant_nodes.dta saved

. 
. 
. ** NEISO 
. use uniquenodes, clear

. keep if my_node_is == "NEISO"
(399 observations deleted)

. di _N
39

. save isonodes, replace
file isonodes.dta saved

. 
. use isonodes, clear

. keep node_name

. merge 1:m node_name using "$dropbox/Data/public/ISO_LMP/NEISO/neiso_lmp_2009.dta", nogen keep(match master)

    Result                           # of obs.
    -----------------------------------------
    not matched                            12
        from master                        12  
        from using                          0  

    matched                           230,329  
    -----------------------------------------

. save apdat, replace 
file apdat.dta saved

. 
. forval i = 2010/2015 {
  2.         use isonodes, clear
  3.         keep node_name
  4.         merge 1:m node_name using "$dropbox/Data/public/ISO_LMP/NEISO/neiso_lmp_`i'.dta", nogen keep(match master)
  5.         append using apdat
  6.         save apdat, replace 
  7. }

    Result                           # of obs.
    -----------------------------------------
    not matched                             7
        from master                         7  
        from using                          0  

    matched                           272,233  
    -----------------------------------------
file apdat.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             5
        from master                         5  
        from using                          0  

    matched                           297,840  
    -----------------------------------------
file apdat.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             5
        from master                         5  
        from using                          0  

    matched                           298,656  
    -----------------------------------------
file apdat.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             5
        from master                         5  
        from using                          0  

    matched                           297,840  
    -----------------------------------------
file apdat.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             5
        from master                         5  
        from using                          0  

    matched                           297,840  
    -----------------------------------------
file apdat.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             9
        from master                         9  
        from using                          0  

    matched                            79,170  
    -----------------------------------------
file apdat.dta saved

. 
. save neiso_plant_nodes, replace
(note: file neiso_plant_nodes.dta not found)
file neiso_plant_nodes.dta saved

. 
. 
. ** NYISO
. use uniquenodes, clear

. keep if my_node_is == "NYISO"
(420 observations deleted)

. di _N
18

. save isonodes, replace
file isonodes.dta saved

. 
. use isonodes, clear

. keep node_name

. merge 1:m node_name using "$dropbox/Data/public/ISO_LMP/NYISO/nyiso_2009.dta", nogen keep(match master)

    Result                           # of obs.
    -----------------------------------------
    not matched                             3
        from master                         3  
        from using                          0  

    matched                           131,265  
    -----------------------------------------

. save apdat, replace 
file apdat.dta saved

. 
. forval i = 2010/2015 {
  2.         use isonodes, clear
  3.         keep node_name
  4.         merge 1:m node_name using "$dropbox/Data/public/ISO_LMP/NYISO/nyiso_`i'.dta", nogen keep(match master)
  5.         append using apdat
  6.         save apdat, replace 
  7. }

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           133,005  
    -----------------------------------------
file apdat.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           156,852  
    -----------------------------------------
file apdat.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           158,094  
    -----------------------------------------
file apdat.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           157,662  
    -----------------------------------------
file apdat.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           157,662  
    -----------------------------------------
file apdat.dta saved

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           157,662  
    -----------------------------------------
file apdat.dta saved

. 
. save nyiso_plant_nodes, replace
(note: file nyiso_plant_nodes.dta not found)
file nyiso_plant_nodes.dta saved

. 
. 
. ** append all together 
. use pjm_plant_nodes, clear

. gen ISO = "PJM"

. di _N
5212944

. save apdat, replace
file apdat.dta saved

. 
. local isolist caiso ercot miso neiso nyiso 

. foreach tn in `isolist' {
  2.         di "`tn'"
  3.         use `tn'_plant_nodes, clear
  4.         gen ISO = strupper("`tn'")
  5.         di _N
  6.         append using apdat
  7.         save apdat, replace
  8. 
. }
caiso
4247431
(note: variable lmp was float, now double to accommodate using data's values)
file apdat.dta saved
ercot
2374974
file apdat.dta saved
miso
9088383
(note: variable ISO was str4, now str5 to accommodate using data's values)
file apdat.dta saved
neiso
1773956
file apdat.dta saved
nyiso
1052205
(note: variable type was str9, now str12 to accommodate using data's values)
(note: variable lmp was float, now double to accommodate using data's values)
file apdat.dta saved

. 
. gen Year = year(date)
(74 missing values generated)

. gen Month = month(date)
(74 missing values generated)

. 
. save "$dropbox/Data/public/ISO_LMP/closenodes_hourly_data.dta", replace
file C:/Dropbox/projects/joe_aldy/1603/Data/public/ISO_LMP/closenodes_hourly_data.dta saved

. 
. 
. ********************************************************************************
. // tempclose 
. // capture log close
. // exit
. 
end of do-file

. bys ISO node_name node_id date hour: gen tn = _N

. tab tn

         tn |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 | 23,749,854      100.00      100.00
          2 |          4        0.00      100.00
          7 |         35        0.00      100.00
------------+-----------------------------------
      Total | 23,749,893      100.00

. browse if tn > 1

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. use neiso_plant_nodes, clear

. keep if node_name == "LD.KINGSTON23"
(1,773,949 observations deleted)

. browse

. 
end of do-file

. use all_iso_negative_lmp, clear
file all_iso_negative_lmp.dta not found
r(601);

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. use "$repodir/generated_data/facility_closestnode.dta", clear

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. use "$repodir/generated_data/facility_closestnode.dta", clear

. keep if node_name == "LD.KINGSTON23"
(938 observations deleted)

. browse

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. use "$repodir/generated_data/neiso_negative_lmp.dta"
no; data in memory would be lost
r(4);

end of do-file

r(4);

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. use "$repodir/generated_data/neiso_negative_lmp.dta", clear

. keep if node_name == "LD.KINGSTON23"
(50,718 observations deleted)

. browse

. 
. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. use "$repodir/generated_data/neiso_negative_lmp.dta", clear

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. use "$repodir/generated_data/neiso_negative_lmp.dta", clear

. arrange node_name 
command arrange is unrecognized
r(199);

end of do-file

r(199);

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. use "$repodir/generated_data/neiso_negative_lmp.dta", clear

. sort node_name 

. browse

. 
end of do-file

. help compress

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. 
. use "$repodir/generated_data/facility_closestnode.dta", clear

. keep if node_name == "LD.KINGSTON23"
(938 observations deleted)

. browse

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. use "$repodir/generated_data/neiso_negative_lmp.dta", clear

. keep if node_name == "LD.KINGSTON23"
(50,718 observations deleted)

. browse

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. use "$repodir/generated_data/neiso_negative_lmp.dta", clear

. compress
  (0 bytes saved)

. keep if node_name == "LD.KINGSTON23"
(50,718 observations deleted)

. browse

. 
end of do-file

. help trim

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. use "$repodir/generated_data/neiso_negative_lmp.dta", clear

. strtrim(node_name)
command strtrim is unrecognized
r(199);

end of do-file

r(199);

. help strtrim()

. help strtrim()

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. replace node_name = strtrim(node_name)
(2,300 real changes made)

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. 
. compress
  variable node_name was str26 now str23
  (152,154 bytes saved)

. keep if node_name == "LD.KINGSTON23"
(50,670 observations deleted)

. browse

. 
end of do-file

. use "$dropbox/Data/public/ISO_LMP/closenodes_hourly_data.dta", clear

. keep if lmp == .
(23,749,231 observations deleted)

. tab ISO

        ISO |      Freq.     Percent        Cum.
------------+-----------------------------------
      CAISO |          8        1.21        1.21
       MISO |         15        2.27        3.47
      NEISO |         48        7.25       10.73
      NYISO |          3        0.45       11.18
        PJM |        588       88.82      100.00
------------+-----------------------------------
      Total |        662      100.00

. keep if node_id == .
(588 observations deleted)

. tab ISO

        ISO |      Freq.     Percent        Cum.
------------+-----------------------------------
      CAISO |          8       10.81       10.81
       MISO |         15       20.27       31.08
      NEISO |         48       64.86       95.95
      NYISO |          3        4.05      100.00
------------+-----------------------------------
      Total |         74      100.00

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. use neiso_plant_nodes, clear

. replace node_name = strtrim(node_name)
(0 real changes made)

. compress
  variable node_id was long now int
  variable node_name was str35 now str20
  (30,157,252 bytes saved)

. keep if node_name == "LD.KINGSTON23"
(1,773,949 observations deleted)

. browse

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. use "$repodir/generated_data/neiso_negative_lmp.dta", clear

. replace node_name = strtrim(node_name)
(2,300 real changes made)

. keep if node_name == "TOT162W1_6_GN001"
(50,718 observations deleted)

. browse

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. use "$repodir/generated_data/facility_closestnode.dta", clear

. keep if node_name == "TOT162W1_6_GN001"
(938 observations deleted)

. browse

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. use "$repodir/generated_data/caiso_negative_lmp.dta", clear

. keep if node_name == "TOT162W1_6_GN001"
(244,829 observations deleted)

. browse

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. use caiso_plant_nodes, clear

. keep if node_name == "TOT162W1_6_GN001"
(4,202,587 observations deleted)

. browse

. 
end of do-file

. di _N
44844

. tab Year
variable Year not found
r(111);

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. use "$dropbox/Data/public/ISO_LMP/closenodes_hourly_data.dta", clear

. keep if node_name == "TOT162W1_6_GN001"
(23,705,049 observations deleted)

. browse

. 
end of do-file

. bys ISO node_name node_id date hour: gen tn = _N

. tab tn

         tn |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     44,844      100.00      100.00
------------+-----------------------------------
      Total |     44,844      100.00

. browse if tn > 1

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. use "$dropbox/Data/public/ISO_LMP/closenodes_hourly_data.dta", clear

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. keep if lmp == .
(23,749,231 observations deleted)

. bys ISO node_name node_id date hour: gen tn = _N

. 
end of do-file

. tab tn

         tn |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        623       94.11       94.11
          2 |          4        0.60       94.71
          7 |         35        5.29      100.00
------------+-----------------------------------
      Total |        662      100.00

. tab ISO tn

           |                tn
       ISO |         1          2          7 |     Total
-----------+---------------------------------+----------
     CAISO |         8          0          0 |         8 
      MISO |        15          0          0 |        15 
     NEISO |         9          4         35 |        48 
     NYISO |         3          0          0 |         3 
       PJM |       588          0          0 |       588 
-----------+---------------------------------+----------
     Total |       623          4         35 |       662 


. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. ** NEISO 
. use uniquenodes, clear

. keep if my_node_is == "NEISO"
(399 observations deleted)

. di _N
39

. replace node_name = strtrim(node_name)
(0 real changes made)

. keep node_name

. save isonodes, replace
file isonodes.dta saved

. 
. use "$dropbox/Data/public/ISO_LMP/NEISO/neiso_lmp_2009.dta", clear

. replace node_name = strtrim(node_name)
(86,956 real changes made)

. merge 1:m node_name using isonodes, nogen keep(match using)
variable node_name does not uniquely identify observations in the master data
r(459);

end of do-file

r(459);

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. ** NEISO 
. use uniquenodes, clear

. keep if my_node_is == "NEISO"
(399 observations deleted)

. di _N
39

. replace node_name = strtrim(node_name)
(0 real changes made)

. keep node_name

. save isonodes, replace
file isonodes.dta saved

. 
. use "$dropbox/Data/public/ISO_LMP/NEISO/neiso_lmp_2009.dta", clear

. replace node_name = strtrim(node_name)
(86,956 real changes made)

. merge 1:m node_name using isonodes, nogen keep(match using)
variable node_name does not uniquely identify observations in the master data
r(459);

end of do-file

r(459);

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. use "$dropbox/Data/public/ISO_LMP/NEISO/neiso_lmp_2009.dta", clear

. replace node_name = strtrim(node_name)
(86,956 real changes made)

. merge m:1 node_name using isonodes, nogen keep(match using)
(note: variable node_name was str23, now str35 to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                            11
        from master                         0  
        from using                         11  

    matched                           235,394  
    -----------------------------------------

. save apdat, replace 
file apdat.dta saved

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. forval i = 2010/2015 {
  2.         use "$dropbox/Data/public/ISO_LMP/NEISO/neiso_lmp_`i'.dta", clear
  3.         replace node_name = strtrim(node_name)
  4.         merge m:1 node_name using isonodes, nogen keep(match using)
  5.         append using apdat
  6.         save apdat, replace 
  7. }
(146,546 real changes made)
(note: variable node_name was str23, now str35 to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             5
        from master                         0  
        from using                          5  

    matched                           289,753  
    -----------------------------------------
file apdat.dta saved
(373,130 real changes made)
(note: variable node_name was str26, now str35 to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           341,640  
    -----------------------------------------
file apdat.dta saved
(437,040 real changes made)
(note: variable node_name was str26, now str35 to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           342,576  
    -----------------------------------------
file apdat.dta saved
(438,000 real changes made)
(note: variable node_name was str26, now str35 to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           341,640  
    -----------------------------------------
file apdat.dta saved
(430,248 real changes made)
(note: variable node_name was str26, now str35 to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                           341,640  
    -----------------------------------------
file apdat.dta saved
(121,106 real changes made)
(note: variable node_name was str26, now str35 to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             4
        from master                         0  
        from using                          4  

    matched                            92,365  
    -----------------------------------------
file apdat.dta saved

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. 
. save neiso_plant_nodes, replace
file neiso_plant_nodes.dta saved

. 
. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. ** append all together 
. use pjm_plant_nodes, clear

. gen ISO = "PJM"

. di _N
5212944

. save apdat, replace
file apdat.dta saved

. 
. local isolist caiso ercot miso neiso nyiso 

. foreach tn in `isolist' {
  2.         di "`tn'"
  3.         use `tn'_plant_nodes, clear
  4.         gen ISO = strupper("`tn'")
  5.         di _N
  6.         append using apdat
  7.         save apdat, replace
  8. 
. }
caiso
4247431
(note: variable lmp was float, now double to accommodate using data's values)
file apdat.dta saved
ercot
2374974
file apdat.dta saved
miso
9088383
(note: variable ISO was str4, now str5 to accommodate using data's values)
file apdat.dta saved
neiso
1985028
file apdat.dta saved
nyiso
1052205
(note: variable type was str9, now str12 to accommodate using data's values)
(note: variable lmp was float, now double to accommodate using data's values)
file apdat.dta saved

. 
. gen Year = year(date)
(46 missing values generated)

. gen Month = month(date)
(46 missing values generated)

. 
. save "$dropbox/Data/public/ISO_LMP/closenodes_hourly_data.dta", replace
file C:/Dropbox/projects/joe_aldy/1603/Data/public/ISO_LMP/closenodes_hourly_data.dta saved

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. clear

. global repodir = substr("`c(pwd)'",1,length("`c(pwd)'") - (strpos(reverse("`c(pwd)'"),reverse("ags_capital_vs_output"
> ))) + 1)

. do "$repodir/code/setup.do"

. clear

. set more off, permanently
(set more preference recorded)

. set matsize 1000

. *set scheme s1mono
. set scheme s1color

. set seed 123456

. 
. ********************************************************************************
. * SET PATHS
. ********************************************************************************
. global repodir = substr("`c(pwd)'",1,length("`c(pwd)'") - (strpos(reverse("`c(pwd)'"),reverse("ags_capital_vs_output"
> ))) + 1)

. 
. do "$repodir/code/paths.do"

. global dropbox "C:/Dropbox/projects/joe_aldy/1603"

. 
end of do-file

. 
. global outdir "$repodir/output" // MAY BE USEFUL TO REDIRECT FOR COMPARISONS/ ROBUSTNESS ETC 

. 
. global generated_data "$dropbox/generated_data"

. ** can uncomment this if you want to run build code and updated right to the repo
. ** but these are very slow. alternatively, `move_files.do` copies files run to the repo
. *global generated_data "$repodir/generated_data" 
. 
. capture mkdir "$repodir/temp"

. capture mkdir "$repodir/output/estimates"

. 
. ********************************************************************************
. * DEFINE PROGRAMS
. ********************************************************************************
. *THIS PROGRAM CD'S TO THE TEMP DIRECTORY AND CLEARS IT
. capture program drop tempsetup

. program define tempsetup
  1. 
.         cd "$repodir/temp"
  2.         local list : dir . files *
  3.         foreach f of local list {
  4.                 erase "`f'"
  5.         }
  6. end 

. 
. 
. *THIS PROGRAM KILLS THE TEMP DIRECTORY
. capture program drop tempclose

. program define tempclose
  1.         pause
  2.         clear
  3.         cd "$repodir/temp"
  4.         local list : dir . files *
  5.         foreach f of local list {
  6.                 erase "`f'"
  7.         }
  8.         cd "$repodir"
  9.         rmdir "$repodir/temp"
 10. end 

. exit 

end of do-file

. 
. tempsetup
C:\GitDir\Projects\ags_capital_vs_output\temp

. 
. // capture log close
. // log using "$outdir/logs/`fname'.txt", replace text
. ********************************************************************************
. 
. //
. // use "$repodir/generated_data/facility_closestaggnode.dta", clear
. // gen nwind = 1
. // gen n1603 = flag_1603
. // collapse (min) km (sum) nwind (sum) n1603 (sum) iso_match, by(my_node_id)
. // rename km_to_my_node_id km_to_wind
. // gen flag_nearwind = 1
. // save closestnodelist, replace
. 
. use $repodir/generated_data/static_reg_data, clear

. keep if firstyear > 2004 & firstyear < 2013
(335 observations deleted)

. keep facilityid 

. merge 1:1 facilityid using "$repodir/generated_data/facility_closestnode.dta", nogen keep(match)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               623  
    -----------------------------------------

. keep if facilityid == 58461 | facilityid == 58511
(621 observations deleted)

. rename my_node_iso ISO 

. save facilitydata, replace
(note: file facilitydata.dta not found)
file facilitydata.dta saved

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. 
. exit

end of do-file


. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. 
. exit

end of do-file


. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. /* GET PROD DURING NEGATIVE HOURS */ 
. 
. *NOTE THIS USES STATA ADOS grc1leg and egenmore
. ********************************************************************************/
. *local fname get_hourly_prices_closenodes
. 
. clear

. global repodir = substr("`c(pwd)'",1,length("`c(pwd)'") - (strpos(reverse("`c(pwd)'"),reverse("ags_capital_vs_output"
> ))) + 1)

. do "$repodir/code/setup.do"

. clear

. set more off, permanently
(set more preference recorded)

. set matsize 1000

. *set scheme s1mono
. set scheme s1color

. set seed 123456

. 
. ********************************************************************************
. * SET PATHS
. ********************************************************************************
. global repodir = substr("`c(pwd)'",1,length("`c(pwd)'") - (strpos(reverse("`c(pwd)'"),reverse("ags_capital_vs_output"
> ))) + 1)

. 
. do "$repodir/code/paths.do"

. global dropbox "C:/Dropbox/projects/joe_aldy/1603"

. 
end of do-file

. 
. global outdir "$repodir/output" // MAY BE USEFUL TO REDIRECT FOR COMPARISONS/ ROBUSTNESS ETC 

. 
. global generated_data "$dropbox/generated_data"

. ** can uncomment this if you want to run build code and updated right to the repo
. ** but these are very slow. alternatively, `move_files.do` copies files run to the repo
. *global generated_data "$repodir/generated_data" 
. 
. capture mkdir "$repodir/temp"

. capture mkdir "$repodir/output/estimates"

. 
. ********************************************************************************
. * DEFINE PROGRAMS
. ********************************************************************************
. *THIS PROGRAM CD'S TO THE TEMP DIRECTORY AND CLEARS IT
. capture program drop tempsetup

. program define tempsetup
  1. 
.         cd "$repodir/temp"
  2.         local list : dir . files *
  3.         foreach f of local list {
  4.                 erase "`f'"
  5.         }
  6. end 

. 
. 
. *THIS PROGRAM KILLS THE TEMP DIRECTORY
. capture program drop tempclose

. program define tempclose
  1.         pause
  2.         clear
  3.         cd "$repodir/temp"
  4.         local list : dir . files *
  5.         foreach f of local list {
  6.                 erase "`f'"
  7.         }
  8.         cd "$repodir"
  9.         rmdir "$repodir/temp"
 10. end 

. exit 

end of do-file

. 
. tempsetup
C:\GitDir\Projects\ags_capital_vs_output\temp

. 
. // capture log close
. // log using "$outdir/logs/`fname'.txt", replace text
. ********************************************************************************
. 
. //
. // use "$repodir/generated_data/facility_closestaggnode.dta", clear
. // gen nwind = 1
. // gen n1603 = flag_1603
. // collapse (min) km (sum) nwind (sum) n1603 (sum) iso_match, by(my_node_id)
. // rename km_to_my_node_id km_to_wind
. // gen flag_nearwind = 1
. // save closestnodelist, replace
. 
. use $repodir/generated_data/static_reg_data, clear

. keep if firstyear > 2004 & firstyear < 2013
(335 observations deleted)

. keep facilityid 

. merge 1:1 facilityid using "$repodir/generated_data/facility_closestnode.dta", nogen keep(match)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               623  
    -----------------------------------------

. keep if facilityid == 58461 | facilityid == 58511
(621 observations deleted)

. rename my_node_iso ISO 

. save facilitydata, replace
(note: file facilitydata.dta not found)
file facilitydata.dta saved

. 
. keep facilityid ISO node_name node_id

. save faclist, replace
(note: file faclist.dta not found)
file faclist.dta saved

. 
. * LOAD AND SAVE A SUBSET OF THE WINDSPEED DATA FOR JUST THE YEARS WE HAVE PRICES FOR
. ** need to move this to the AGS folder
. use "C:\Dropbox\data\wind_speed_data\wind_all_plants.dta" if date > date("20100101","YMD"), clear

. gen double eventtime = clock(fields, "YMDhms")

. format eventtime %tc

. gen hour = hh(eventtime)

. capture drop date

. gen date=dofc(eventtime)

. format %td date

. gen Year = year(date)

. gen Month = month(date)

. gen Day = day(date)

. 
. drop fields 

. save windtempdat, replace
(note: file windtempdat.dta not found)
file windtempdat.dta saved

. 
. 
. use "$generated_data/models_powercurve_xwalk.dta", clear

. * this should be zero in the TWP power curve data 
. replace w5 = 0 if powercurve_turbinemodel == "swt-2.3-101"
(42 real changes made)

. save xwalk, replace
(note: file xwalk.dta not found)
file xwalk.dta saved

. 
. ** THIS SECTION COPIED FROM calc_output.do 
. * CREATE A DATASET WITH JUST REFERENCE POWERCURVE
. use xwalk, clear

. keep if powercurve_turbinemodel == "1.5sle"
(730 observations deleted)

. keep powercurve_turbinemodel w*

. duplicates drop

Duplicates in terms of all variables

(228 observations deleted)

. *note this renvars command no longer used. see here https://www.statalist.org/forums/forum/general-stata-discussion/g
> eneral/1560780-renvars-command
. *renvars w*, prefix("ref")
. rename (w*) ref=

. save reference_powercurve, replace
(note: file reference_powercurve.dta not found)
file reference_powercurve.dta saved

. 
. 
. use windtempdat, clear

. merge m:1 facilityid using faclist, nogen keep(match)
(note: variable facilityid was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                            90,434  
    -----------------------------------------

.                 
.         * Bring in powercurve for each facility
.         merge m:1 facilityid using  xwalk, keep(master matched) nogen

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                            90,434  
    -----------------------------------------

.         
.         **************************************
.         * CALC OUTPUT USING MATCHED POWERCURVE
.         **************************************
.         gen output = 0

.         * Multiplying by 2 because w30 corresponds to 15 miles per hour. 
.         * So if wind is 15.32 becomes 30 so then output for w30 gets selected
.         gen wind = round(windspeed_80m * 2)

.         
.         forval i = 0 / 60 {
  2.                 replace output = w`i' if wind == `i'
  3.         }
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(2,342 real changes made)
(4,338 real changes made)
(4,998 real changes made)
(5,488 real changes made)
(5,983 real changes made)
(6,056 real changes made)
(6,065 real changes made)
(6,182 real changes made)
(5,754 real changes made)
(5,219 real changes made)
(4,917 real changes made)
(4,511 real changes made)
(4,156 real changes made)
(3,406 real changes made)
(3,087 real changes made)
(2,401 real changes made)
(1,951 real changes made)
(1,435 real changes made)
(1,176 real changes made)
(959 real changes made)
(706 real changes made)
(565 real changes made)
(394 real changes made)
(296 real changes made)
(254 real changes made)
(144 real changes made)
(88 real changes made)
(69 real changes made)
(26 real changes made)
(24 real changes made)
(10 real changes made)
(12 real changes made)
(13 real changes made)
(3 real changes made)
(2 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

.         gen output_adjusted  = (pressure_0m / temperature_2m) / (101325 / 288.15) * output

.         
.         *****************************************************
.         * CALC REFERENCE OUTPUT (OUTPUT USING MODAL TURBINE)
.         *****************************************************
.         
.         * Regular output for unmatched turbines was using modal turbine. Dont' need to calc again
.         if flag_powercurve == 0 | powercurve_turbinemodel == "1.5sle" {
.                 gen output_refturb = output
.                 gen output_refturb_adjusted = output_adjusted
.         }

. 
.         * FOR MATCHED FACILITIES, GOING TO BRING IN MODAL POWERCURVE AND CALCULATE OUTPUT
.         else {
.                 cross using reference_powercurve
.                 gen output_refturb = 0
.                 forval i = 0 / 60 {
  2.                         replace output_refturb = refw`i' if wind == `i'
  3.                 }
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(4,338 real changes made)
(4,998 real changes made)
(5,488 real changes made)
(5,983 real changes made)
(6,056 real changes made)
(6,065 real changes made)
(6,182 real changes made)
(5,754 real changes made)
(5,219 real changes made)
(4,917 real changes made)
(4,511 real changes made)
(4,156 real changes made)
(3,406 real changes made)
(3,087 real changes made)
(2,401 real changes made)
(1,951 real changes made)
(1,435 real changes made)
(1,176 real changes made)
(959 real changes made)
(706 real changes made)
(565 real changes made)
(394 real changes made)
(296 real changes made)
(254 real changes made)
(144 real changes made)
(88 real changes made)
(69 real changes made)
(26 real changes made)
(24 real changes made)
(10 real changes made)
(12 real changes made)
(13 real changes made)
(3 real changes made)
(2 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
.                 gen output_refturb_adjusted = (pressure_0m / temperature_2m) / (101325 / 288.15) * output_refturb
.         }

. 
.         foreach var in output output_adjusted output_refturb output_refturb_adjusted {
  2.                 replace `var' = `var' / 1000
  3.         }
(83,030 real changes made)
(83,030 real changes made)
(80,688 real changes made)
(80,688 real changes made)

.         
.         gen reference_turbine_capacity = 1.5

.         label var output "Monthly output (MWH)"

.         label var output_adjusted "Monthly output (MWH) adjusted for temp and pressure"

.         label var output_refturb "Monthly output using the modal turbine"

.         label var output_refturb_adjusted "Monthly output using modal turbine adj for temp and pressure"

. 
. keep facilityid hour Year Month Day ISO node_name node_id output wind /// 
>                         output_adjusted output_refturb output_refturb_adjusted

. save outputhours, replace
(note: file outputhours.dta not found)
file outputhours.dta saved

. 
. 
. use "$dropbox/Data/public/ISO_LMP/closenodes_hourly_data.dta", clear

. keep if Year > 2009
(2,430,094 observations deleted)

. gen Day = day(date)
(46 missing values generated)

. joinby ISO node_name node_id using faclist

. * somehow this generates fewer than 8760 bos for some plants : example -- GYSR78TP_1_N005
. sort facilityid Year Month Day hour

. drop mcc mlc 

. replace hour = hour - 1
(102,852 real changes made)

. save longnodedat, replace
(note: file longnodedat.dta not found)
file longnodedat.dta saved

. 
. 
. use longnodedat, clear

. drop if Year == . | Month == .
(0 observations deleted)

. merge 1:1 facilityid Year Month Day hour using outputhours, keep(match using)
(note: variable facilityid was long, now double to accommodate using data's values)
(note: variable hour was byte, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,996
        from master                         0  (_merge==1)
        from using                      1,996  (_merge==2)

    matched                            88,438  (_merge==3)
    -----------------------------------------

. gen flag_misslmp = cond(_merge <3,1,0)

. replace lmp = 1 if lmp == .
(1,996 real changes made)

. capture drop lmp_l* l_out*

. 
. local outlist 0 5 15 23 25

. foreach t in `outlist' {
  2.         
.         gen lmp_l`t' = cond(lmp < (-`t'),1,0)
  3.         gen l_output_`t' = output*lmp_l`t'
  4.         gen l_output_adj_`t' = output_adjusted*lmp_l`t'
  5.         gen l_output_ref_`t' = output_refturb*lmp_l`t'
  6.         gen l_output_ref_adj_`t' = output_refturb_adjusted*lmp_l`t'
  7. 
. }

. 
. gen monthours = 1

. collapse (sum) output* l_* lmp_l* flag_misslmp monthours, by(facilityid Year Month)

. 
. save facility_negative_prod, replace
(note: file facility_negative_prod.dta not found)
file facility_negative_prod.dta saved

. 
. 
. use facilitydata, clear

. merge 1:m facilityid using facility_negative_prod, nogen keep(match)
(note: variable facilityid was long, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               126  
    -----------------------------------------

. 
. gen share_l0 = lmp_l0/monthours

. gen share_l23 = lmp_l23/monthours

. 
. gen output_share_l0 = l_output_0/output

. gen output_share_l23 = l_output_23/output

. gen output_share_l0_adj = l_output_adj_0/output_adj

. gen output_share_l23_adj = l_output_adj_23/output_adj

. 
. gen misshare = flag_misslmp/monthours

. 
. rename Year year 

. rename Month month

. rename output_adj output_adj_new

. rename output output_new

. rename ISO node_ISO_new

. 
. keep facilityid year month share_* /// 
>                 l_output_0 l_output_23 output_new ///
>                 l_output_adj_0 l_output_adj_23 output_adj_new ///
>                 misshare monthours iso_match km_to_my_node_id output_share_* node_ISO_new
variable iso_match not found
r(111);

end of do-file

r(111);

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. keep facilityid year month share_* /// 
>                 l_output_0 l_output_23 output_new ///
>                 l_output_adj_0 l_output_adj_23 output_adj_new ///
>                 misshare monthours km_to_my_node_id output_share_* node_ISO_new
variable km_to_my_node_id not found
r(111);

end of do-file

r(111);

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. keep facilityid year month share_* /// 
>                 l_output_0 l_output_23 output_new ///
>                 l_output_adj_0 l_output_adj_23 output_adj_new ///
>                 misshare monthours km_to_my_node output_share_* node_ISO_new

. 
. save negative_correction, replace
(note: file negative_correction.dta not found)
file negative_correction.dta saved

. 
end of do-file

. sum *

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  facilityid |        126       58486     25.0998      58461      58511
km_to_my_n~g |        126     1368.12    1361.657   11.87744   2724.362
node_ISO_new |          0
        year |        126    2012.143    1.526902       2010       2015
       month |        126    6.285714    3.521039          1         12
-------------+---------------------------------------------------------
  output_new |        126    289.2262    187.1307       .201    714.541
output_adj~w |        126    284.0524    185.8076   .2103917   739.0609
  l_output_0 |        126    27.66307    41.84532          0    207.916
l_output_a~0 |        126    26.87488    40.64529          0   197.8213
 l_output_23 |        126    5.925556    10.62389          0     64.812
-------------+---------------------------------------------------------
l_output_a~3 |        126    5.752802    10.29393          0   61.48767
   monthours |        126    717.7302    93.71381          1        744
    share_l0 |        126    .0566155    .0528289          0   .2446237
   share_l23 |        126    .0136735    .0171525          0   .1180556
output_sha~0 |        126    .0697216    .0705064          0   .3437844
-------------+---------------------------------------------------------
output_sh~23 |        126     .016061    .0200709          0   .1243129
output~0_adj |        126    .0692552    .0696568          0   .3389613
output~3_adj |        126    .0159611    .0198453          0   .1220737
    misshare |        126    .0217234    .0219006          0   .0513889

. di _N
126

. tab year

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
       2010 |         24       19.05       19.05
       2011 |         24       19.05       38.10
       2012 |         24       19.05       57.14
       2013 |         24       19.05       76.19
       2014 |         24       19.05       95.24
       2015 |          6        4.76      100.00
------------+-----------------------------------
      Total |        126      100.00

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. use $repodir/generated_data/static_reg_data, clear

. keep if firstyear > 2004 & firstyear < 2013
(335 observations deleted)

. keep facilityid 

. merge 1:1 facilityid using "$repodir/generated_data/facility_closestnode.dta", nogen keep(match)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               623  
    -----------------------------------------

. * keep if facilityid == 58461 | facilityid == 58511
. rename my_node_iso ISO 

. save facilitydata, replace
file facilitydata.dta saved

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. /* GET PROD DURING NEGATIVE HOURS */ 
. 
. *NOTE THIS USES STATA ADOS grc1leg and egenmore
. ********************************************************************************/
. *local fname get_hourly_prices_closenodes
. 
. clear

. global repodir = substr("`c(pwd)'",1,length("`c(pwd)'") - (strpos(reverse("`c(pwd)'"),reverse("ags_capital_vs_output"
> ))) + 1)

. do "$repodir/code/setup.do"

. clear

. set more off, permanently
(set more preference recorded)

. set matsize 1000

. *set scheme s1mono
. set scheme s1color

. set seed 123456

. 
. ********************************************************************************
. * SET PATHS
. ********************************************************************************
. global repodir = substr("`c(pwd)'",1,length("`c(pwd)'") - (strpos(reverse("`c(pwd)'"),reverse("ags_capital_vs_output"
> ))) + 1)

. 
. do "$repodir/code/paths.do"

. global dropbox "C:/Dropbox/projects/joe_aldy/1603"

. 
end of do-file

. 
. global outdir "$repodir/output" // MAY BE USEFUL TO REDIRECT FOR COMPARISONS/ ROBUSTNESS ETC 

. 
. global generated_data "$dropbox/generated_data"

. ** can uncomment this if you want to run build code and updated right to the repo
. ** but these are very slow. alternatively, `move_files.do` copies files run to the repo
. *global generated_data "$repodir/generated_data" 
. 
. capture mkdir "$repodir/temp"

. capture mkdir "$repodir/output/estimates"

. 
. ********************************************************************************
. * DEFINE PROGRAMS
. ********************************************************************************
. *THIS PROGRAM CD'S TO THE TEMP DIRECTORY AND CLEARS IT
. capture program drop tempsetup

. program define tempsetup
  1. 
.         cd "$repodir/temp"
  2.         local list : dir . files *
  3.         foreach f of local list {
  4.                 erase "`f'"
  5.         }
  6. end 

. 
. 
. *THIS PROGRAM KILLS THE TEMP DIRECTORY
. capture program drop tempclose

. program define tempclose
  1.         pause
  2.         clear
  3.         cd "$repodir/temp"
  4.         local list : dir . files *
  5.         foreach f of local list {
  6.                 erase "`f'"
  7.         }
  8.         cd "$repodir"
  9.         rmdir "$repodir/temp"
 10. end 

. exit 

end of do-file

. 
. tempsetup
C:\GitDir\Projects\ags_capital_vs_output\temp

. 
. // capture log close
. // log using "$outdir/logs/`fname'.txt", replace text
. ********************************************************************************
. 
. //
. // use "$repodir/generated_data/facility_closestaggnode.dta", clear
. // gen nwind = 1
. // gen n1603 = flag_1603
. // collapse (min) km (sum) nwind (sum) n1603 (sum) iso_match, by(my_node_id)
. // rename km_to_my_node_id km_to_wind
. // gen flag_nearwind = 1
. // save closestnodelist, replace
. 
. use $repodir/generated_data/static_reg_data, clear

. keep if firstyear > 2004 & firstyear < 2013
(335 observations deleted)

. keep facilityid 

. merge 1:1 facilityid using "$repodir/generated_data/facility_closestnode.dta", nogen keep(match)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               623  
    -----------------------------------------

. * keep if facilityid == 58461 | facilityid == 58511
. rename my_node_iso ISO 

. save facilitydata, replace
(note: file facilitydata.dta not found)
file facilitydata.dta saved

. 
. keep facilityid ISO node_name node_id

. save faclist, replace
(note: file faclist.dta not found)
file faclist.dta saved

. 
. * LOAD AND SAVE A SUBSET OF THE WINDSPEED DATA FOR JUST THE YEARS WE HAVE PRICES FOR
. ** need to move this to the AGS folder
. use "C:\Dropbox\data\wind_speed_data\wind_all_plants.dta" if date > date("20100101","YMD"), clear

. gen double eventtime = clock(fields, "YMDhms")

. format eventtime %tc

. gen hour = hh(eventtime)

. capture drop date

. gen date=dofc(eventtime)

. format %td date

. gen Year = year(date)

. gen Month = month(date)

. gen Day = day(date)

. 
. drop fields 

. save windtempdat, replace
(note: file windtempdat.dta not found)
file windtempdat.dta saved

. 
. 
. use "$generated_data/models_powercurve_xwalk.dta", clear

. * this should be zero in the TWP power curve data 
. replace w5 = 0 if powercurve_turbinemodel == "swt-2.3-101"
(42 real changes made)

. save xwalk, replace
(note: file xwalk.dta not found)
file xwalk.dta saved

. 
. ** THIS SECTION COPIED FROM calc_output.do 
. * CREATE A DATASET WITH JUST REFERENCE POWERCURVE
. use xwalk, clear

. keep if powercurve_turbinemodel == "1.5sle"
(730 observations deleted)

. keep powercurve_turbinemodel w*

. duplicates drop

Duplicates in terms of all variables

(228 observations deleted)

. *note this renvars command no longer used. see here https://www.statalist.org/forums/forum/general-stata-discussion/g
> eneral/1560780-renvars-command
. *renvars w*, prefix("ref")
. rename (w*) ref=

. save reference_powercurve, replace
(note: file reference_powercurve.dta not found)
file reference_powercurve.dta saved

. 
. 
. use windtempdat, clear

. merge m:1 facilityid using faclist, nogen keep(match)
(note: variable facilityid was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                        27,226,586  
    -----------------------------------------

.                 
.         * Bring in powercurve for each facility
.         merge m:1 facilityid using  xwalk, keep(master matched) nogen

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                        27,226,586  
    -----------------------------------------

.         
.         **************************************
.         * CALC OUTPUT USING MATCHED POWERCURVE
.         **************************************
.         gen output = 0

.         * Multiplying by 2 because w30 corresponds to 15 miles per hour. 
.         * So if wind is 15.32 becomes 30 so then output for w30 gets selected
.         gen wind = round(windspeed_80m * 2)

.         
.         forval i = 0 / 60 {
  2.                 replace output = w`i' if wind == `i'
  3.         }
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(30,786 real changes made)
(474,807 real changes made)
(1,014,862 real changes made)
(1,284,466 real changes made)
(1,420,772 real changes made)
(1,528,007 real changes made)
(1,610,884 real changes made)
(1,655,521 real changes made)
(1,655,071 real changes made)
(1,615,097 real changes made)
(1,548,858 real changes made)
(1,448,199 real changes made)
(1,343,131 real changes made)
(1,223,376 real changes made)
(1,089,941 real changes made)
(959,720 real changes made)
(833,959 real changes made)
(714,895 real changes made)
(605,649 real changes made)
(509,791 real changes made)
(422,193 real changes made)
(345,479 real changes made)
(279,783 real changes made)
(223,665 real changes made)
(173,537 real changes made)
(132,460 real changes made)
(99,752 real changes made)
(73,006 real changes made)
(54,113 real changes made)
(38,900 real changes made)
(27,049 real changes made)
(18,476 real changes made)
(13,129 real changes made)
(8,965 real changes made)
(6,163 real changes made)
(3,887 real changes made)
(2,034 real changes made)
(1,379 real changes made)
(917 real changes made)
(604 real changes made)
(404 real changes made)
(259 real changes made)
(177 real changes made)
(92 real changes made)
(50 real changes made)
(49 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

.         gen output_adjusted  = (pressure_0m / temperature_2m) / (101325 / 288.15) * output

.         
.         *****************************************************
.         * CALC REFERENCE OUTPUT (OUTPUT USING MODAL TURBINE)
.         *****************************************************
.         
.         * Regular output for unmatched turbines was using modal turbine. Dont' need to calc again
.         if flag_powercurve == 0 | powercurve_turbinemodel == "1.5sle" {
.                 gen output_refturb = output
.                 gen output_refturb_adjusted = output_adjusted
.         }

. 
.         * FOR MATCHED FACILITIES, GOING TO BRING IN MODAL POWERCURVE AND CALCULATE OUTPUT
.         else {
.                 cross using reference_powercurve
.                 gen output_refturb = 0
.                 forval i = 0 / 60 {
  2.                         replace output_refturb = refw`i' if wind == `i'
  3.                 }
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(972,142 real changes made)
(1,136,106 real changes made)
(1,292,095 real changes made)
(1,420,772 real changes made)
(1,528,007 real changes made)
(1,610,884 real changes made)
(1,655,521 real changes made)
(1,655,071 real changes made)
(1,615,097 real changes made)
(1,548,858 real changes made)
(1,448,199 real changes made)
(1,343,131 real changes made)
(1,223,376 real changes made)
(1,089,941 real changes made)
(959,720 real changes made)
(833,959 real changes made)
(714,895 real changes made)
(605,649 real changes made)
(509,791 real changes made)
(422,193 real changes made)
(345,479 real changes made)
(279,783 real changes made)
(223,665 real changes made)
(173,537 real changes made)
(132,460 real changes made)
(99,752 real changes made)
(73,006 real changes made)
(54,258 real changes made)
(39,005 real changes made)
(27,109 real changes made)
(18,522 real changes made)
(13,157 real changes made)
(8,981 real changes made)
(6,173 real changes made)
(3,895 real changes made)
(2,458 real changes made)
(1,686 real changes made)
(1,104 real changes made)
(731 real changes made)
(488 real changes made)
(314 real changes made)
(206 real changes made)
(117 real changes made)
(72 real changes made)
(59 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
.                 gen output_refturb_adjusted = (pressure_0m / temperature_2m) / (101325 / 288.15) * output_refturb
.         }

. 
.         foreach var in output output_adjusted output_refturb output_refturb_adjusted {
  2.                 replace `var' = `var' / 1000
  3.         }
(24,494,314 real changes made)
(24,494,314 real changes made)
(25,091,424 real changes made)
(25,091,424 real changes made)

.         
.         gen reference_turbine_capacity = 1.5

.         label var output "Monthly output (MWH)"

.         label var output_adjusted "Monthly output (MWH) adjusted for temp and pressure"

.         label var output_refturb "Monthly output using the modal turbine"

.         label var output_refturb_adjusted "Monthly output using modal turbine adj for temp and pressure"

. 
. keep facilityid hour Year Month Day ISO node_name node_id output wind /// 
>                         output_adjusted output_refturb output_refturb_adjusted

. save outputhours, replace
(note: file outputhours.dta not found)
file outputhours.dta saved

. 
. 
. use "$dropbox/Data/public/ISO_LMP/closenodes_hourly_data.dta", clear

. keep if Year > 2009
(2,430,094 observations deleted)

. gen Day = day(date)
(46 missing values generated)

. joinby ISO node_name node_id using faclist

. * somehow this generates fewer than 8760 bos for some plants : example -- GYSR78TP_1_N005
. sort facilityid Year Month Day hour

. drop mcc mlc 

. replace hour = hour - 1
(27,987,657 real changes made)

. save longnodedat, replace
(note: file longnodedat.dta not found)
file longnodedat.dta saved

. 
. 
. use longnodedat, clear

. drop if Year == . | Month == .
(53 observations deleted)

. merge 1:1 facilityid Year Month Day hour using outputhours, keep(match using)
(note: variable facilityid was long, now double to accommodate using data's values)
(note: variable hour was byte, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                     3,506,293
        from master                         0  (_merge==1)
        from using                  3,506,293  (_merge==2)

    matched                        23,720,293  (_merge==3)
    -----------------------------------------

. gen flag_misslmp = cond(_merge <3,1,0)

. replace lmp = 1 if lmp == .
(3,506,572 real changes made)

. capture drop lmp_l* l_out*

. 
. local outlist 0 5 15 23 25

. foreach t in `outlist' {
  2.         
.         gen lmp_l`t' = cond(lmp < (-`t'),1,0)
  3.         gen l_output_`t' = output*lmp_l`t'
  4.         gen l_output_adj_`t' = output_adjusted*lmp_l`t'
  5.         gen l_output_ref_`t' = output_refturb*lmp_l`t'
  6.         gen l_output_ref_adj_`t' = output_refturb_adjusted*lmp_l`t'
  7. 
. }

. 
. gen monthours = 1

. collapse (sum) output* l_* lmp_l* flag_misslmp monthours, by(facilityid Year Month)

. 
. save facility_negative_prod, replace
(note: file facility_negative_prod.dta not found)
file facility_negative_prod.dta saved

. 
. 
. use facilitydata, clear

. merge 1:m facilityid using facility_negative_prod, nogen keep(match)
(note: variable facilityid was long, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                            37,934  
    -----------------------------------------

. 
. gen share_l0 = lmp_l0/monthours

. gen share_l23 = lmp_l23/monthours

. 
. gen output_share_l0 = l_output_0/output
(55 missing values generated)

. gen output_share_l23 = l_output_23/output
(55 missing values generated)

. gen output_share_l0_adj = l_output_adj_0/output_adj
(55 missing values generated)

. gen output_share_l23_adj = l_output_adj_23/output_adj
(55 missing values generated)

. 
. gen misshare = flag_misslmp/monthours

. 
. rename Year year 

. rename Month month

. rename output_adj output_adj_new

. rename output output_new

. rename ISO node_ISO_new

. 
. keep facilityid year month share_* /// 
>                 l_output_0 l_output_23 output_new ///
>                 l_output_adj_0 l_output_adj_23 output_adj_new ///
>                 misshare monthours km_to_my_node output_share_* node_ISO_new

. 
. save "$repodir/generated_data/negative_correction.dta", replace
(note: file C:\GitDir\Projects\ags_capital_vs_output/generated_data/negative_correction.dta not found)
file C:\GitDir\Projects\ags_capital_vs_output/generated_data/negative_correction.dta saved

. 
. exit

end of do-file


. sum *

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  facilityid |     37,934    56709.74    4924.045        944      58511
km_to_my_n~g |     37,934    153.1754    450.4955   .0108145   3790.479
node_ISO_new |          0
        year |     37,934    2012.143    1.521256       2010       2015
       month |     37,934    6.285232    3.506872          1         12
-------------+---------------------------------------------------------
  output_new |     37,934    482.5429    232.7134          0     1869.3
output_adj~w |     37,934    455.3589    222.2601          0   1827.637
  l_output_0 |     37,934    30.80638    56.20942          0    644.532
l_output_a~0 |     37,934    28.94719    52.94808          0   588.4998
 l_output_23 |     37,934    8.047794    24.39309          0    561.327
-------------+---------------------------------------------------------
l_output_a~3 |     37,934    7.584739    22.88432          0    489.688
   monthours |     37,934    717.7357    93.33336          1        744
    share_l0 |     37,934    .0415883     .061516          0          1
   share_l23 |     37,934     .011033    .0266666          0          1
output_sha~0 |     37,879     .056716    .0845764          0          1
-------------+---------------------------------------------------------
output_sh~23 |     37,879    .0147408    .0371418          0   .5346153
output~0_adj |     37,879    .0563854    .0840193          0          1
output~3_adj |     37,879     .014659    .0368964          0   .5312035
    misshare |     37,934    .1280613     .309556          0          1

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. use $repodir/generated_data/panel_reg_data, clear

. keep if insample_covars
(32,194 observations deleted)

. * restrict to balanced panel
. keep if year>=2010
(8,840 observations deleted)

. 
. 
. merge 1:1 facilityid year month using "$repodir/generated_data/negative_correction.dta", nogen keep(match)
(note: variable facilityid was long, now double to accommodate using data's values)
(note: variable year was int, now float to accommodate using data's values)
(note: variable month was byte, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                            22,735  
    -----------------------------------------

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. tab in_iso iso_dummy

    Binary |
  variable |
whether in |        ISO/RTO
an ISO/RTO |         0          1 |     Total
-----------+----------------------+----------
         0 |     4,325      1,705 |     6,030 
         1 |         0     16,345 |    16,345 
-----------+----------------------+----------
     Total |     4,325     18,050 |    22,375 


. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. tab iso_rto_code iso_dummy

iso_rto_cod |  ISO/RTO
          e |         1 |     Total
------------+-----------+----------
      CAISO |     1,730 |     1,730 
      ERCOT |     2,620 |     2,620 
      ISONE |       463 |       463 
       MISO |     6,644 |     6,644 
      NYISO |       867 |       867 
      OTHER |        82 |        82 
        PJM |     2,208 |     2,208 
        SPP |     3,724 |     3,724 
------------+-----------+----------
      Total |    18,338 |    18,338 


. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. tab iso_rto_code 

iso_rto_cod |
          e |      Freq.     Percent        Cum.
------------+-----------------------------------
      CAISO |      1,730        9.43        9.43
      ERCOT |      2,620       14.29       23.72
      ISONE |        463        2.52       26.25
       MISO |      6,644       36.23       62.48
      NYISO |        867        4.73       67.20
      OTHER |         82        0.45       67.65
        PJM |      2,208       12.04       79.69
        SPP |      3,724       20.31      100.00
------------+-----------------------------------
      Total |     18,338      100.00

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. tab iso_dummy 

    ISO/RTO |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      4,397       19.34       19.34
          1 |     18,338       80.66      100.00
------------+-----------------------------------
      Total |     22,735      100.00

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. drop if iso_dummy == 0
(4,397 observations deleted)

. tab iso_rto_code node_ISO_new

iso_rto_cod |                           node_ISO_new
          e |     CAISO      ERCOT       MISO      NEISO      NYISO        PJM |     Total
------------+------------------------------------------------------------------+----------
      CAISO |     1,730          0          0          0          0          0 |     1,730 
      ERCOT |         0      2,620          0          0          0          0 |     2,620 
      ISONE |         0          0          0        463          0          0 |       463 
       MISO |         0          0      6,498          0          0        146 |     6,644 
      NYISO |         0          0          0          0        867          0 |       867 
      OTHER |        38          0         44          0          0          0 |        82 
        PJM |         0          0        150          0          0      2,058 |     2,208 
        SPP |         0      1,855      1,869          0          0          0 |     3,724 
------------+------------------------------------------------------------------+----------
      Total |     1,768      4,475      8,561        463        867      2,204 |    18,338 


. 
end of do-file

. sum km
km ambiguous abbreviation
r(111);

. sum km_to_my_node_string

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
km_to_my_n~g |     18,338    50.26686    79.61161   .0108145   403.1346

. sum km_to_my_node_string

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
km_to_my_n~g |     18,338    50.26686    79.61161   .0108145   403.1346

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. use $repodir/generated_data/panel_reg_data, clear

. keep if insample_covars
(32,194 observations deleted)

. * restrict to balanced panel
. keep if year>=2010
(8,840 observations deleted)

. 
. 
. merge 1:1 facilityid year month using "$repodir/generated_data/negative_correction.dta", nogen keep(match)
(note: variable facilityid was long, now double to accommodate using data's values)
(note: variable year was int, now float to accommodate using data's values)
(note: variable month was byte, now float to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                            22,735  
    -----------------------------------------

. 
. drop if iso_dummy == 0
(4,397 observations deleted)

. *tab iso_rto_code node_ISO_new
. *sum km_to_my_node_string
. 
. *replace capacity_factor = (1 - output_share_l0_adj)*capacity_factor if flag_1603 == 0
. 
. *replace capacity_factor = (1 + output_share_l0_adj)*capacity_factor if flag_1603 ==1
. *replace ptnl_cf_adj = (1 - output_share_l0_adj)*ptnl_cf_adj if flag_1603 ==1
. 
. clonevar date = ymdate

. xi i.state i.windclass_eia i.date i.nercnum i.off_cat_num ///
>         i.ott i.iso_rto_code i.entnum, prefix(_D) noomit

. drop  _Ddate_659 // drop same period in each reg

. drop if age == 0 // output could be for partial month at time 0
(176 observations deleted)

. replace log_netgen = log(netgen + 1)
(18,162 real changes made)

. gen log_ptnl_output_adj = log(ptnl_output_adj)

. lab var log_ptnl_output_adj "log(Potential Output)"

. lab var ptnl_cf_adj "Potential Capacity Factor"

. lab var design_windspeed_eia "Design Wind Speed"

. 
. save regdat_bw, replace
(note: file regdat_bw.dta not found)
file regdat_bw.dta saved

. 
. * restrict sample to firms that began operating between 2008-2009
. keep if firstyear==2008 | firstyear==2009
(10,909 observations deleted)

. 
. 
. 
. * NEW: TRY TO PREDICT RESPONSE DURING NEGATIVE HOURS 
. drop ptnl_*

. gen ptnl_cf = output_new/(monthours*turbine_capacity_pc)*100 

. gen ptnl_cf_l0 = l_output_0/(monthours*turbine_capacity_pc)*100 

. gen ptnl_cf_g0 = ptnl_cf - ptnl_cf_l0

. gen ptnl_cf_adj = output_adj_new/(monthours*turbine_capacity_pc)*100 

. gen ptnl_cf_adj_l0 = l_output_adj_0/(monthours*turbine_capacity_pc)*100 

. gen ptnl_cf_adj_g0 = ptnl_cf_adj - ptnl_cf_adj_l0

. 
. gen ptnl_output = monthcap*ptnl_cf/100

. gen ptnl_output_adj = monthcap*ptnl_cf_adj/100

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. reghdfe capacity_factor ptnl_cf_adj ptnl_cf_adj_l0 if flag_1603 == 0, ///
>         absorb(facilityid date)
(converged in 3 iterations)

HDFE Linear regression                            Number of obs   =      4,980
Absorbing 2 HDFE groups                           F(   2,   4836) =    1655.14
                                                  Prob > F        =     0.0000
                                                  R-squared       =     0.7946
                                                  Adj R-squared   =     0.7885
                                                  Within R-sq.    =     0.4064
                                                  Root MSE        =     5.1223

--------------------------------------------------------------------------------
capacity_fac~r |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
---------------+----------------------------------------------------------------
   ptnl_cf_adj |    .628599   .0112538    55.86   0.000     .6065364    .6506617
ptnl_cf_adj_l0 |   .1249166   .0202801     6.16   0.000     .0851583    .1646748
---------------+----------------------------------------------------------------
      Absorbed |      F(141, 4836) =     34.612   0.000             (Joint test)
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------------+
   Absorbed FE |  Num. Coefs.  =   Categories  -   Redundant     | 
---------------+-------------------------------------------------|
    facilityid |           83              83              0     | 
          date |           59              60              1     | 
-----------------------------------------------------------------+

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. reghdfe capacity_factor ptnl_cf_adj ptnl_cf_adj_l0 if flag_1603 == 1, ///
>         absorb(facilityid date) 
(converged in 5 iterations)

HDFE Linear regression                            Number of obs   =      2,273
Absorbing 2 HDFE groups                           F(   2,   2174) =     543.52
                                                  Prob > F        =     0.0000
                                                  R-squared       =     0.7219
                                                  Adj R-squared   =     0.7094
                                                  Within R-sq.    =     0.3333
                                                  Root MSE        =     5.9333

--------------------------------------------------------------------------------
capacity_fac~r |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
---------------+----------------------------------------------------------------
   ptnl_cf_adj |   .5684179    .017364    32.74   0.000     .5343662    .6024696
ptnl_cf_adj_l0 |  -.2656705   .0354782    -7.49   0.000    -.3352452   -.1960958
---------------+----------------------------------------------------------------
      Absorbed |       F(96, 2174) =     22.960   0.000             (Joint test)
--------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------------+
   Absorbed FE |  Num. Coefs.  =   Categories  -   Redundant     | 
---------------+-------------------------------------------------|
    facilityid |           38              38              0     | 
          date |           59              60              1     | 
-----------------------------------------------------------------+

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. reghdfe capacity_factor i.flag_1603#c.ptnl_cf_adj i.flag_1603#c.ptnl_cf_adj_l0, ///
>         absorb(facilityid date) 
(converged in 4 iterations)

HDFE Linear regression                            Number of obs   =      7,253
Absorbing 2 HDFE groups                           F(   4,   7069) =    1099.15
                                                  Prob > F        =     0.0000
                                                  R-squared       =     0.7784
                                                  Adj R-squared   =     0.7727
                                                  Within R-sq.    =     0.3835
                                                  Root MSE        =     5.3911

--------------------------------------------------------------------------------------------
           capacity_factor |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
---------------------------+----------------------------------------------------------------
   flag_1603#c.ptnl_cf_adj |
                        0  |   .6318341   .0106871    59.12   0.000     .6108843     .652784
                        1  |   .5567574   .0118068    47.16   0.000     .5336125    .5799024
                           |
flag_1603#c.ptnl_cf_adj_l0 |
                        0  |   .1118021   .0206182     5.42   0.000     .0713843    .1522198
                        1  |  -.2468334   .0306704    -8.05   0.000    -.3069567   -.1867102
---------------------------+----------------------------------------------------------------
                  Absorbed |      F(179, 7069) =     39.137   0.000             (Joint test)
--------------------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------------------------------+
               Absorbed FE |  Num. Coefs.  =   Categories  -   Redundant     | 
---------------------------+-------------------------------------------------|
                facilityid |          121             121              0     | 
                      date |           59              60              1     | 
-----------------------------------------------------------------------------+

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. areg capacity_factor ptnl_cf_adj ptnl_cf_adj_l0 _Dd* if flag_1603 == 1, absorb(facilityid)

Linear regression, absorbing indicators         Number of obs     =      2,273
                                                F(  61,   2174)   =      61.09
                                                Prob > F          =     0.0000
                                                R-squared         =     0.7219
                                                Adj R-squared     =     0.7094
                                                Root MSE          =     5.9333

--------------------------------------------------------------------------------
capacity_fac~r |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
---------------+----------------------------------------------------------------
   ptnl_cf_adj |   .5684179    .017364    32.74   0.000     .5343662    .6024696
ptnl_cf_adj_l0 |  -.2656705   .0354782    -7.49   0.000    -.3352452   -.1960958
    _Ddate_600 |  -3.465027   1.415225    -2.45   0.014    -6.240362   -.6896915
    _Ddate_601 |  -3.491468   1.381413    -2.53   0.012    -6.200496   -.7824408
    _Ddate_602 |  -2.499321   1.361944    -1.84   0.067     -5.17017    .1715271
    _Ddate_603 |   .0051582   1.364236     0.00   0.997    -2.670185    2.680501
    _Ddate_604 |  -.9768217   1.362583    -0.72   0.474    -3.648924     1.69528
    _Ddate_605 |   -.461174   1.373386    -0.34   0.737    -3.154461    2.232113
    _Ddate_606 |  -2.587102   1.388599    -1.86   0.063    -5.310222    .1360173
    _Ddate_607 |  -1.504038   1.390298    -1.08   0.279    -4.230489    1.222414
    _Ddate_608 |  -1.744735   1.367637    -1.28   0.202    -4.426747    .9372778
    _Ddate_609 |   .8142472    1.36349     0.60   0.550    -1.859632    3.488126
    _Ddate_610 |  -.1169075   1.365378    -0.09   0.932     -2.79449    2.560675
    _Ddate_611 |  -2.753725   1.363401    -2.02   0.044    -5.427431   -.0800194
    _Ddate_612 |  -1.015775   1.363366    -0.75   0.456    -3.689411    1.657861
    _Ddate_613 |   1.121591   1.382374     0.81   0.417    -1.589322    3.832504
    _Ddate_614 |  -.1046973   1.372059    -0.08   0.939    -2.795381    2.585986
    _Ddate_615 |   2.714377   1.393502     1.95   0.052    -.0183579    5.447111
    _Ddate_616 |   1.813985   1.370479     1.32   0.186    -.8736005     4.50157
    _Ddate_617 |   1.939851   1.368639     1.42   0.157     -.744127    4.623828
    _Ddate_618 |  -.2449144   1.399932    -0.17   0.861    -2.990259     2.50043
    _Ddate_619 |   -.855614   1.400964    -0.61   0.541    -3.602983    1.891755
    _Ddate_620 |  -1.321225   1.386249    -0.95   0.341    -4.039738    1.397287
    _Ddate_621 |   2.108357   1.363781     1.55   0.122     -.566093    4.782808
    _Ddate_622 |   3.930158   1.385338     2.84   0.005     1.213434    6.646883
    _Ddate_623 |   1.099391   1.364027     0.81   0.420    -1.575543    3.774325
    _Ddate_624 |   3.194199   1.380028     2.31   0.021     .4878872    5.900511
    _Ddate_625 |   .0244051   1.366527     0.02   0.986    -2.655432    2.704242
    _Ddate_626 |   2.140708   1.385843     1.54   0.123    -.5770078    4.858423
    _Ddate_627 |   1.783899   1.370552     1.30   0.193    -.9038306    4.471628
    _Ddate_628 |   2.143277   1.370469     1.56   0.118    -.5442887    4.830843
    _Ddate_629 |    2.24478    1.36826     1.64   0.101    -.4384534    4.928013
    _Ddate_630 |  -.6234631   1.399303    -0.45   0.656    -3.367575    2.120649
    _Ddate_631 |  -1.128849   1.404662    -0.80   0.422     -3.88347    1.625772
    _Ddate_632 |  -.8732561   1.379324    -0.63   0.527    -3.578187    1.831675
    _Ddate_633 |   2.112117   1.361505     1.55   0.121    -.5578709    4.782105
    _Ddate_634 |   .9833001   1.366258     0.72   0.472    -1.696008    3.662608
    _Ddate_635 |   .6680284   1.362057     0.49   0.624    -2.003041    3.339097
    _Ddate_636 |  -1.287497   1.368445    -0.94   0.347    -3.971094    1.396099
    _Ddate_637 |  -1.731542   1.367321    -1.27   0.206    -4.412935    .9498507
    _Ddate_638 |   .2171731   1.365855     0.16   0.874    -2.461345    2.895691
    _Ddate_639 |   3.926389   1.368947     2.87   0.004     1.241807    6.610971
    _Ddate_640 |   3.776206   1.362441     2.77   0.006     1.104384    6.448028
    _Ddate_641 |   2.635713   1.371138     1.92   0.055    -.0531644    5.324591
    _Ddate_642 |  -.7818975   1.393878    -0.56   0.575     -3.51537    1.951575
    _Ddate_643 |   -1.95652   1.404541    -1.39   0.164    -4.710903    .7978634
    _Ddate_644 |  -1.572136   1.381625    -1.14   0.255     -4.28158    1.137309
    _Ddate_645 |   .1993917   1.364741     0.15   0.884    -2.476941    2.875725
    _Ddate_646 |   3.064243   1.372501     2.23   0.026     .3726923    5.755794
    _Ddate_647 |  -1.491207   1.361338    -1.10   0.273    -4.160867    1.178452
    _Ddate_648 |  -.4047089   1.397476    -0.29   0.772    -3.145237    2.335819
    _Ddate_649 |  -.8486138   1.366555    -0.62   0.535    -3.528504    1.831277
    _Ddate_650 |   1.014933   1.373537     0.74   0.460     -1.67865    3.708515
    _Ddate_651 |   2.920591   1.381222     2.11   0.035      .211938    5.629244
    _Ddate_652 |   2.139491   1.363228     1.57   0.117    -.5338745    4.812856
    _Ddate_653 |   2.605294   1.366663     1.91   0.057    -.0748093    5.285397
    _Ddate_654 |  -.5319585   1.381089    -0.39   0.700    -3.240351    2.176434
    _Ddate_655 |  -1.772228   1.406764    -1.26   0.208    -4.530972    .9865149
    _Ddate_656 |  -1.260783   1.381712    -0.91   0.362    -3.970398    1.448832
    _Ddate_657 |     1.0085   1.362341     0.74   0.459    -1.663127    3.680128
    _Ddate_658 |   4.594741   1.377066     3.34   0.001     1.894238    7.295245
         _cons |   8.421512   1.188457     7.09   0.000     6.090881    10.75214
---------------+----------------------------------------------------------------
    facilityid |       F(37, 2174) =     50.542   0.000          (38 categories)

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. capture drop pred_cf 

. predict pred_cf_base
(option xb assumed; fitted values)

. replace ptnl_cf_adj_l0 = 0
(5,461 real changes made)

. predict pred_cf_extra
(option xb assumed; fitted values)

. gen extra_cf = pred_cf_extra - pred_cf_base

. 
. gen capacity_factor_extra = capacity_factor

. replace capacity_factor_extra = capacity_factor + extra_cf if flag_1603
(1,502 real changes made)

. 
. save regdat, replace
(note: file regdat.dta not found)
file regdat.dta saved

. 
. use regdat, clear

. * specify regression structure once
. 
. gen cf_ptc_adj = capacity_factor

. replace  cf_ptc_adj = (1 - output_share_l0_adj)*capacity_factor if flag_1603 == 0
(3,959 real changes made)

. 
. gen cf_1603_adj = capacity_factor

. replace  cf_1603_adj = (1 + output_share_l0_adj)*capacity_factor if flag_1603 == 1
(1,502 real changes made)

. 
. *replace capacity_factor = (1 + output_share_l0_adj)*capacity_factor if flag_1603 ==1
. 
. global temp_avs _Dd* // _Dst*

. 
. global covars reg_dummy ppa_dummy ipp_dummy ptnl_cf_adj windvar log_nameplate 

. 
. eststo clear

. 
. qui: eststo : ivreg2 capacity_factor (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) 
> first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "103"

.                 estadd local model = "main", replace

added macro:
              e(model) : "main"

.                 
.                 
. qui: eststo : ivreg2 cf_ptc_adj (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "103"

.                 estadd local model = "cf_ptc_adj", replace              

added macro:
              e(model) : "cf_ptc_adj"

.                 
. qui: eststo : ivreg2 cf_1603_adj (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) firs
> t

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "103"

.                 estadd local model = "cf_1603_adj", replace                             

added macro:
              e(model) : "cf_1603_adj"

. 
. qui: eststo : ivreg2 capacity_factor_extra (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp
> _avs) first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "103"

.                 estadd local model = "extra", replace           

added macro:
              e(model) : "extra"

. 
. esttab, /// drop(_D*)   ///
>         s(model N fstat, ///
>                 label("cf model" "N" "First-stage F-stat.")) ///
>         se noconstant nonumbers label star(* 0.10 ** 0.05 *** 0.01)

------------------------------------------------------------------------------------
                     Capacity F~r      cf_ptc_adj     cf_1603_adj    capacity_f~a   
------------------------------------------------------------------------------------
1603 Grant                 -3.033*          0.304          -1.237          -2.384   
                          (1.613)         (1.512)         (1.665)         (1.615)   

Regulated                  -1.924          -2.222          -1.846          -1.929   
                          (2.084)         (2.068)         (2.120)         (2.077)   

PPA                        -1.195          -1.539          -0.907          -1.105   
                          (1.244)         (1.201)         (1.302)         (1.254)   

IPP                        -2.089          -2.063          -2.266          -2.154   
                          (1.611)         (1.590)         (1.619)         (1.600)   

ptnl_cf_adj                 0.468***        0.447***        0.487***        0.479***
                         (0.0426)        (0.0385)        (0.0412)        (0.0412)   

Var(Wind Speed)             0.275           0.182           0.350*          0.299   
                          (0.185)         (0.170)         (0.186)         (0.184)   

log(Capacity)              -0.438           0.278          -0.331          -0.402   
                          (0.504)         (0.479)         (0.518)         (0.503)   
------------------------------------------------------------------------------------
cf model                     main      cf_ptc_adj     cf_1603_adj           extra   
N                            7253            7253            7253            7253   
First-stage F-stat.           103             103             103             103   
------------------------------------------------------------------------------------
Standard errors in parentheses
* p<0.10, ** p<0.05, *** p<0.01

.         
. 
end of do-file

. tab Year
variable Year not found
r(111);

. tab year

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
       2010 |      1,445       19.92       19.92
       2011 |      1,452       20.02       39.94
       2012 |      1,452       20.02       59.96
       2013 |      1,452       20.02       79.98
       2014 |      1,452       20.02      100.00
------------+-----------------------------------
      Total |      7,253      100.00

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. use regdat, clear

. * specify regression structure once
. keep if Year > 2010
Year not found
r(111);

end of do-file

r(111);

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. use regdat, clear

. * specify regression structure once
. drop if year == 2010
(1,445 observations deleted)

. 
. gen cf_ptc_adj = capacity_factor

. replace  cf_ptc_adj = (1 - output_share_l0_adj)*capacity_factor if flag_1603 == 0
(3,305 real changes made)

. 
. gen cf_1603_adj = capacity_factor

. replace  cf_1603_adj = (1 + output_share_l0_adj)*capacity_factor if flag_1603 == 1
(1,269 real changes made)

. 
. *replace capacity_factor = (1 + output_share_l0_adj)*capacity_factor if flag_1603 ==1
. 
. global temp_avs _Dd* // _Dst*

. 
. global covars reg_dummy ppa_dummy ipp_dummy ptnl_cf_adj windvar log_nameplate 

. 
. eststo clear

. 
. qui: eststo : ivreg2 capacity_factor (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) 
> first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "104"

.                 estadd local model = "main", replace

added macro:
              e(model) : "main"

.                 
.                 
. qui: eststo : ivreg2 cf_ptc_adj (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "104"

.                 estadd local model = "cf_ptc_adj", replace              

added macro:
              e(model) : "cf_ptc_adj"

.                 
. qui: eststo : ivreg2 cf_1603_adj (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) firs
> t

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "104"

.                 estadd local model = "cf_1603_adj", replace                             

added macro:
              e(model) : "cf_1603_adj"

. 
. qui: eststo : ivreg2 capacity_factor_extra (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp
> _avs) first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "104"

.                 estadd local model = "extra", replace           

added macro:
              e(model) : "extra"

. 
. esttab, /// drop(_D*)   ///
>         s(model N fstat, ///
>                 label("cf model" "N" "First-stage F-stat.")) ///
>         se noconstant nonumbers label star(* 0.10 ** 0.05 *** 0.01)

------------------------------------------------------------------------------------
                     Capacity F~r      cf_ptc_adj     cf_1603_adj    capacity_f~a   
------------------------------------------------------------------------------------
1603 Grant                 -3.169*          0.609          -1.179          -2.446   
                          (1.682)         (1.557)         (1.752)         (1.690)   

Regulated                  -2.600          -2.601          -2.586          -2.634   
                          (2.144)         (2.105)         (2.191)         (2.139)   

PPA                        -1.357          -1.624          -1.057          -1.267   
                          (1.292)         (1.237)         (1.368)         (1.309)   

IPP                        -2.627          -2.427          -2.861*         -2.714*  
                          (1.633)         (1.608)         (1.644)         (1.621)   

ptnl_cf_adj                 0.512***        0.481***        0.540***        0.526***
                         (0.0449)        (0.0403)        (0.0432)        (0.0431)   

Var(Wind Speed)             0.179          0.0976           0.247           0.199   
                          (0.202)         (0.187)         (0.202)         (0.201)   

log(Capacity)              -0.310           0.441          -0.186          -0.268   
                          (0.531)         (0.496)         (0.549)         (0.531)   
------------------------------------------------------------------------------------
cf model                     main      cf_ptc_adj     cf_1603_adj           extra   
N                            5808            5808            5808            5808   
First-stage F-stat.           104             104             104             104   
------------------------------------------------------------------------------------
Standard errors in parentheses
* p<0.10, ** p<0.05, *** p<0.01

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. global temp_avs _Dd* _Dst*

. 
. global covars reg_dummy ppa_dummy ipp_dummy ptnl_cf_adj windvar log_nameplate 

. 
. eststo clear

. 
. qui: eststo : ivreg2 capacity_factor (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) 
> first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "99"

.                 estadd local model = "main", replace

added macro:
              e(model) : "main"

.                 
.                 
. qui: eststo : ivreg2 cf_ptc_adj (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "99"

.                 estadd local model = "cf_ptc_adj", replace              

added macro:
              e(model) : "cf_ptc_adj"

.                 
. qui: eststo : ivreg2 cf_1603_adj (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) firs
> t

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "99"

.                 estadd local model = "cf_1603_adj", replace                             

added macro:
              e(model) : "cf_1603_adj"

. 
. qui: eststo : ivreg2 capacity_factor_extra (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp
> _avs) first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "99"

.                 estadd local model = "extra", replace           

added macro:
              e(model) : "extra"

. 
. esttab, /// drop(_D*)   ///
>         s(model N fstat, ///
>                 label("cf model" "N" "First-stage F-stat.")) ///
>         se noconstant nonumbers label star(* 0.10 ** 0.05 *** 0.01)

------------------------------------------------------------------------------------
                     Capacity F~r      cf_ptc_adj     cf_1603_adj    capacity_f~a   
------------------------------------------------------------------------------------
1603 Grant                 -3.039**         0.201          -0.300          -2.015*  
                          (1.250)         (1.178)         (1.239)         (1.192)   

Regulated                  -5.742**        -4.699*         -6.962***       -6.222***
                          (2.435)         (2.536)         (2.445)         (2.385)   

PPA                        -3.211***       -3.122***       -3.376***       -3.284***
                          (1.101)         (1.086)         (1.101)         (1.080)   

IPP                        -3.290**        -2.452          -3.435**        -3.330** 
                          (1.601)         (1.693)         (1.565)         (1.557)   

ptnl_cf_adj                 0.535***        0.517***        0.562***        0.549***
                         (0.0446)        (0.0393)        (0.0427)        (0.0427)   

Var(Wind Speed)            -0.329**        -0.473***       -0.269**        -0.311** 
                          (0.135)         (0.128)         (0.131)         (0.132)   

log(Capacity)               0.827           1.198**         0.879           0.829   
                          (0.564)         (0.585)         (0.538)         (0.539)   
------------------------------------------------------------------------------------
cf model                     main      cf_ptc_adj     cf_1603_adj           extra   
N                            5808            5808            5808            5808   
First-stage F-stat.            99              99              99              99   
------------------------------------------------------------------------------------
Standard errors in parentheses
* p<0.10, ** p<0.05, *** p<0.01

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. bys facilityid: gen tN = _N

. 
end of do-file

. tab tN

         tN |      Freq.     Percent        Cum.
------------+-----------------------------------
         48 |      5,808      100.00      100.00
------------+-----------------------------------
      Total |      5,808      100.00

. distinct facilityid
command distinct is unrecognized
r(199);

. unique facilityid
Number of unique values of facilityid is  121
Number of records is  5808

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. eststo clear

. 
. qui: eststo : ivreg2 capacity_factor (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) 
> first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "99"

.                 estadd local model = "main", replace

added macro:
              e(model) : "main"

.                 
. qui: eststo : ivreg2 cf_1603_adj (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) firs
> t

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "99"

.                 estadd local model = "cf_1603_adj", replace                             

added macro:
              e(model) : "cf_1603_adj"

. 
. qui: eststo : ivreg2 capacity_factor_extra (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp
> _avs) first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "99"

.                 estadd local model = "extra", replace           

added macro:
              e(model) : "extra"

. 
. global temp_avs _Dd* _Dst*

. 
. qui: eststo : ivreg2 capacity_factor (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) 
> first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "99"

.                 estadd local model = "main", replace

added macro:
              e(model) : "main"

.                 estadd local state "Y", replace

added macro:
              e(state) : "Y"

.                 
. qui: eststo : ivreg2 cf_1603_adj (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) firs
> t

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "99"

.                 estadd local model = "cf_1603_adj", replace                             

added macro:
              e(model) : "cf_1603_adj"

.                 estadd local state "Y", replace

added macro:
              e(state) : "Y"

. 
. qui: eststo : ivreg2 capacity_factor_extra (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp
> _avs) first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "99"

.                 estadd local model = "extra", replace           

added macro:
              e(model) : "extra"

.                 estadd local state "Y", replace

added macro:
              e(state) : "Y"

. 
. esttab, /// drop(_D*)   ///
>         s(model N fstat, ///
>                 label("cf model" "N" "First-stage F-stat.")) ///
>         se noconstant nonumbers label star(* 0.10 ** 0.05 *** 0.01)

--------------------------------------------------------------------------------------------------------------------
                     Capacity F~r     cf_1603_adj    capacity_f~a    Capacity F~r     cf_1603_adj    capacity_f~a   
--------------------------------------------------------------------------------------------------------------------
1603 Grant                 -3.039**        -0.300          -2.015*         -3.039**        -0.300          -2.015*  
                          (1.250)         (1.239)         (1.192)         (1.250)         (1.239)         (1.192)   

Regulated                  -5.742**        -6.962***       -6.222***       -5.742**        -6.962***       -6.222***
                          (2.435)         (2.445)         (2.385)         (2.435)         (2.445)         (2.385)   

PPA                        -3.211***       -3.376***       -3.284***       -3.211***       -3.376***       -3.284***
                          (1.101)         (1.101)         (1.080)         (1.101)         (1.101)         (1.080)   

IPP                        -3.290**        -3.435**        -3.330**        -3.290**        -3.435**        -3.330** 
                          (1.601)         (1.565)         (1.557)         (1.601)         (1.565)         (1.557)   

ptnl_cf_adj                 0.535***        0.562***        0.549***        0.535***        0.562***        0.549***
                         (0.0446)        (0.0427)        (0.0427)        (0.0446)        (0.0427)        (0.0427)   

Var(Wind Speed)            -0.329**        -0.269**        -0.311**        -0.329**        -0.269**        -0.311** 
                          (0.135)         (0.131)         (0.132)         (0.135)         (0.131)         (0.132)   

log(Capacity)               0.827           0.879           0.829           0.827           0.879           0.829   
                          (0.564)         (0.538)         (0.539)         (0.564)         (0.538)         (0.539)   
--------------------------------------------------------------------------------------------------------------------
cf model                     main     cf_1603_adj           extra            main     cf_1603_adj           extra   
N                            5808            5808            5808            5808            5808            5808   
First-stage F-stat.            99              99              99              99              99              99   
--------------------------------------------------------------------------------------------------------------------
Standard errors in parentheses
* p<0.10, ** p<0.05, *** p<0.01

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. global temp_avs _Dd* 

. 
. global covars reg_dummy ppa_dummy ipp_dummy ptnl_cf_adj windvar log_nameplate 

. 
. eststo clear

. 
. qui: eststo : ivreg2 capacity_factor (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) 
> first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "104"

.                 estadd local model = "main", replace

added macro:
              e(model) : "main"

.                 
. qui: eststo : ivreg2 cf_1603_adj (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) firs
> t

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "104"

.                 estadd local model = "cf_1603_adj", replace                             

added macro:
              e(model) : "cf_1603_adj"

. 
. qui: eststo : ivreg2 capacity_factor_extra (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp
> _avs) first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "104"

.                 estadd local model = "extra", replace           

added macro:
              e(model) : "extra"

. 
. global temp_avs _Dd* _Dst*

. 
. qui: eststo : ivreg2 capacity_factor (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) 
> first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "99"

.                 estadd local model = "main", replace

added macro:
              e(model) : "main"

.                 estadd local state "Y", replace

added macro:
              e(state) : "Y"

.                 
. qui: eststo : ivreg2 cf_1603_adj (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) firs
> t

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "99"

.                 estadd local model = "cf_1603_adj", replace                             

added macro:
              e(model) : "cf_1603_adj"

.                 estadd local state "Y", replace

added macro:
              e(state) : "Y"

. 
. qui: eststo : ivreg2 capacity_factor_extra (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp
> _avs) first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "99"

.                 estadd local model = "extra", replace           

added macro:
              e(model) : "extra"

.                 estadd local state "Y", replace

added macro:
              e(state) : "Y"

. 
. esttab, /// drop(_D*)   ///
>         s(model N fstat, ///
>                 label("cf model" "N" "First-stage F-stat.")) ///
>         se noconstant nonumbers label star(* 0.10 ** 0.05 *** 0.01)

--------------------------------------------------------------------------------------------------------------------
                     Capacity F~r     cf_1603_adj    capacity_f~a    Capacity F~r     cf_1603_adj    capacity_f~a   
--------------------------------------------------------------------------------------------------------------------
1603 Grant                 -3.169*         -1.179          -2.446          -3.039**        -0.300          -2.015*  
                          (1.682)         (1.752)         (1.690)         (1.250)         (1.239)         (1.192)   

Regulated                  -2.600          -2.586          -2.634          -5.742**        -6.962***       -6.222***
                          (2.144)         (2.191)         (2.139)         (2.435)         (2.445)         (2.385)   

PPA                        -1.357          -1.057          -1.267          -3.211***       -3.376***       -3.284***
                          (1.292)         (1.368)         (1.309)         (1.101)         (1.101)         (1.080)   

IPP                        -2.627          -2.861*         -2.714*         -3.290**        -3.435**        -3.330** 
                          (1.633)         (1.644)         (1.621)         (1.601)         (1.565)         (1.557)   

ptnl_cf_adj                 0.512***        0.540***        0.526***        0.535***        0.562***        0.549***
                         (0.0449)        (0.0432)        (0.0431)        (0.0446)        (0.0427)        (0.0427)   

Var(Wind Speed)             0.179           0.247           0.199          -0.329**        -0.269**        -0.311** 
                          (0.202)         (0.202)         (0.201)         (0.135)         (0.131)         (0.132)   

log(Capacity)              -0.310          -0.186          -0.268           0.827           0.879           0.829   
                          (0.531)         (0.549)         (0.531)         (0.564)         (0.538)         (0.539)   
--------------------------------------------------------------------------------------------------------------------
cf model                     main     cf_1603_adj           extra            main     cf_1603_adj           extra   
N                            5808            5808            5808            5808            5808            5808   
First-stage F-stat.           104             104             104              99              99              99   
--------------------------------------------------------------------------------------------------------------------
Standard errors in parentheses
* p<0.10, ** p<0.05, *** p<0.01

. 
. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. global dv capacity_factor 

. quietly: estimateregs

. esttab, keep(flag_1603) ///
>         s(regtype covars state r2a N fstat, ///
>                 label("Regression Type" "Controls" "State FE" "R-sq." "N" "First-stage F-stat.")) ///
>         se noconstant nonumbers label star(* 0.10 ** 0.05 *** 0.01)

--------------------------------------------------------------------------------------------------------------------
                     Capacity F~r    Capacity F~r    Capacity F~r    Capacity F~r    Capacity F~r    Capacity F~r   
--------------------------------------------------------------------------------------------------------------------
1603 Grant                 -4.682***       -3.924***       -2.742***       -3.311**        -3.169*         -3.039** 
                          (1.178)         (1.179)         (0.908)         (1.659)         (1.682)         (1.250)   
--------------------------------------------------------------------------------------------------------------------
Regression Type               OLS             OLS             OLS            2SLS            2SLS            2SLS   
Controls                        N               Y               Y               N               Y               Y   
State FE                        N               N               Y               N               N               Y   
R-sq.                       0.413           0.600           0.722               -               -               -   
N                            5808            5808            5808            5808            5808            5808   
First-stage F-stat.                                                           108             104              99   
--------------------------------------------------------------------------------------------------------------------
Standard errors in parentheses
* p<0.10, ** p<0.05, *** p<0.01

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. esttab, keep(flag_1603) ///
>         s(model N fstat, ///
>                 label("cf model" "N" "First-stage F-stat.")) ///
>         se noconstant nonumbers label star(* 0.10 ** 0.05 *** 0.01)

--------------------------------------------------------------------------------------------------------------------
                     Capacity F~r    Capacity F~r    Capacity F~r    Capacity F~r    Capacity F~r    Capacity F~r   
--------------------------------------------------------------------------------------------------------------------
1603 Grant                 -4.682***       -3.924***       -2.742***       -3.311**        -3.169*         -3.039** 
                          (1.178)         (1.179)         (0.908)         (1.659)         (1.682)         (1.250)   
--------------------------------------------------------------------------------------------------------------------
cf model                      ols             ols             ols              iv              iv              iv   
N                            5808            5808            5808            5808            5808            5808   
First-stage F-stat.                                                           108             104              99   
--------------------------------------------------------------------------------------------------------------------
Standard errors in parentheses
* p<0.10, ** p<0.05, *** p<0.01

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. global temp_avs _Dd* 

. 
. global covars reg_dummy ppa_dummy ipp_dummy ptnl_cf_adj windvar log_nameplate 

. 
. eststo clear

. 
. qui: eststo : ivreg2 capacity_factor (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) 
> first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "104"

.                 estadd local model = "main", replace

added macro:
              e(model) : "main"

.                 
. qui: eststo : ivreg2 cf_1603_adj (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) firs
> t

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "104"

.                 estadd local model = "cf_1603_adj", replace                             

added macro:
              e(model) : "cf_1603_adj"

. 
. qui: eststo : ivreg2 capacity_factor_extra (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp
> _avs) first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "104"

.                 estadd local model = "extra", replace           

added macro:
              e(model) : "extra"

. 
. global temp_avs _Dd* _Dst*

. 
. qui: eststo : ivreg2 capacity_factor (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) 
> first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "99"

.                 estadd local model = "main", replace

added macro:
              e(model) : "main"

.                 estadd local state "Y", replace

added macro:
              e(state) : "Y"

.                 
. qui: eststo : ivreg2 cf_1603_adj (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) firs
> t

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "99"

.                 estadd local model = "cf_1603_adj", replace                             

added macro:
              e(model) : "cf_1603_adj"

.                 estadd local state "Y", replace

added macro:
              e(state) : "Y"

. 
. qui: eststo : ivreg2 capacity_factor_extra (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp
> _avs) first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "99"

.                 estadd local model = "extra", replace           

added macro:
              e(model) : "extra"

.                 estadd local state "Y", replace

added macro:
              e(state) : "Y"

. 
. esttab, keep(flag_1603) ///
>         s(model N fstat, ///
>                 label("cf model" "N" "First-stage F-stat.")) ///
>         se noconstant nonumbers label star(* 0.10 ** 0.05 *** 0.01)

--------------------------------------------------------------------------------------------------------------------
                     Capacity F~r     cf_1603_adj    capacity_f~a    Capacity F~r     cf_1603_adj    capacity_f~a   
--------------------------------------------------------------------------------------------------------------------
1603 Grant                 -3.169*         -1.179          -2.446          -3.039**        -0.300          -2.015*  
                          (1.682)         (1.752)         (1.690)         (1.250)         (1.239)         (1.192)   
--------------------------------------------------------------------------------------------------------------------
cf model                     main     cf_1603_adj           extra            main     cf_1603_adj           extra   
N                            5808            5808            5808            5808            5808            5808   
First-stage F-stat.           104             104             104              99              99              99   
--------------------------------------------------------------------------------------------------------------------
Standard errors in parentheses
* p<0.10, ** p<0.05, *** p<0.01

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. global temp_avs _Dd* 

. 
. global covars reg_dummy ppa_dummy ipp_dummy ptnl_cf_adj windvar log_nameplate 

. 
. eststo clear

. 
. qui: eststo : ivreg2 capacity_factor (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) 
> first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "104"

.                 estadd local model = "none", replace

added macro:
              e(model) : "none"

.                 
. qui: eststo : ivreg2 cf_1603_adj (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) firs
> t

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "104"

.                 estadd local model = "full potential", replace                          

added macro:
              e(model) : "full potential"

. 
. qui: eststo : ivreg2 capacity_factor_extra (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp
> _avs) first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "104"

.                 estadd local model = "predicted", replace               

added macro:
              e(model) : "predicted"

. 
. global temp_avs _Dd* _Dst*

. 
. qui: eststo : ivreg2 capacity_factor (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) 
> first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "99"

.                 estadd local model = "main", replace

added macro:
              e(model) : "main"

.                 estadd local state "Y", replace

added macro:
              e(state) : "Y"

.                 
. qui: eststo : ivreg2 cf_1603_adj (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp_avs) firs
> t

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "99"

.                 estadd local model = "full potential", replace                          

added macro:
              e(model) : "full potential"

.                 estadd local state "Y", replace

added macro:
              e(state) : "Y"

. 
. qui: eststo : ivreg2 capacity_factor_extra (flag_1603 = policy) $covars $temp_avs , cluster(facilityid) partial($temp
> _avs) first

.                 mat def a = e(first)

.                 estadd local fstat = round(a[4,1])

added macro:
              e(fstat) : "99"

.                 estadd local model = "predicted", replace               

added macro:
              e(model) : "predicted"

.                 estadd local state "Y", replace

added macro:
              e(state) : "Y"

. 
. esttab, keep(flag_1603) ///
>         s(model N fstat, ///
>                 label("Output Adjustment" "N" "First-stage F-stat.")) ///
>         se noconstant nonumbers label star(* 0.10 ** 0.05 *** 0.01)

--------------------------------------------------------------------------------------------------------------------
                     Capacity F~r     cf_1603_adj    capacity_f~a    Capacity F~r     cf_1603_adj    capacity_f~a   
--------------------------------------------------------------------------------------------------------------------
1603 Grant                 -3.169*         -1.179          -2.446          -3.039**        -0.300          -2.015*  
                          (1.682)         (1.752)         (1.690)         (1.250)         (1.239)         (1.192)   
--------------------------------------------------------------------------------------------------------------------
Output Adjustment            none    full potential       predicted            main    full potential       predicted  
>  
N                            5808            5808            5808            5808            5808            5808   
First-stage F-stat.           104             104             104              99              99              99   
--------------------------------------------------------------------------------------------------------------------
Standard errors in parentheses
* p<0.10, ** p<0.05, *** p<0.01

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. esttab, keep(flag_1603) ///
>         s(model state N fstat, ///
>                 label("Output Adjustment" "State FE" "N" "First-stage F-stat.")) ///
>         se noconstant nonumbers label star(* 0.10 ** 0.05 *** 0.01)

--------------------------------------------------------------------------------------------------------------------
                     Capacity F~r     cf_1603_adj    capacity_f~a    Capacity F~r     cf_1603_adj    capacity_f~a   
--------------------------------------------------------------------------------------------------------------------
1603 Grant                 -3.169*         -1.179          -2.446          -3.039**        -0.300          -2.015*  
                          (1.682)         (1.752)         (1.690)         (1.250)         (1.239)         (1.192)   
--------------------------------------------------------------------------------------------------------------------
Output Adjustment            none    full potential       predicted            main    full potential       predicted  
>  
State FE                                                                        Y               Y               Y   
N                            5808            5808            5808            5808            5808            5808   
First-stage F-stat.           104             104             104              99              99              99   
--------------------------------------------------------------------------------------------------------------------
Standard errors in parentheses
* p<0.10, ** p<0.05, *** p<0.01

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. esttab, keep(flag_1603) ///
>         s(model state N fstat, ///
>                 label("Output Adjustment" "State FE" "N" "First-stage F-stat.")) ///
>         se noconstant nonumbers label star(* 0.10 ** 0.05 *** 0.01)

--------------------------------------------------------------------------------------------------------------------
                     Capacity F~r     cf_1603_adj    capacity_f~a    Capacity F~r     cf_1603_adj    capacity_f~a   
--------------------------------------------------------------------------------------------------------------------
1603 Grant                 -3.169*         -1.179          -2.446          -3.039**        -0.300          -2.015*  
                          (1.682)         (1.752)         (1.690)         (1.250)         (1.239)         (1.192)   
--------------------------------------------------------------------------------------------------------------------
Output Adjustment            none    full potential       predicted            main    full potential       predicted   
State FE                                                                        Y               Y               Y   
N                            5808            5808            5808            5808            5808            5808   
First-stage F-stat.           104             104             104              99              99              99   
--------------------------------------------------------------------------------------------------------------------
Standard errors in parentheses
* p<0.10, ** p<0.05, *** p<0.01

. 
end of do-file

. do "C:\Users\sweeneri\AppData\Local\Temp\STD145e8_000000.tmp"

. *EXPORT FOR PAPER
. esttab using "$outdir/tables/rdd_regs_negative_output.tex" , ///
>         se noconstant label star(* 0.10 ** 0.05 *** 0.01) replace  ///
>         keep(flag_1603) nonotes compress order(flag_1603) ///
>         s(model state N fstat, ///
>                 label("Output Adjustment" "State FE" "N" "First-stage F-stat.")) ///
>         nomtitles booktabs 
(note: file C:\GitDir\Projects\ags_capital_vs_output/output/tables/rdd_regs_negative_output.tex not found)
(output written to C:\GitDir\Projects\ags_capital_vs_output/output/tables/rdd_regs_negative_output.tex)

. 
end of do-file

